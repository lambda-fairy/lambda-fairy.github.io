general:
  branches:
    ignore:
      - master

machine:
  pre:
    # http://stackoverflow.com/q/34654262
    - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.6 20
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.6 20
    - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 10
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 10
  ghc:
    version: 7.10.2
  ruby:
    version: '2.2'

dependencies:
  override:
    - gem install sass --no-rdoc --no-ri
    - cabal update
    - cabal install --only-dependencies -O0 -j

test:
  override:
    - cabal configure -O0 && cabal run --ghc-option=-j -- rebuild

deployment:
  push:
    branch: source
    commands:
      - deploy/deploy 'Circle CI'
